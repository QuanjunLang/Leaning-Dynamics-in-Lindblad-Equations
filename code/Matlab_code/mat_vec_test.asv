clc
close all
clear all
rng(1)


%%
r = 2;
n = 2;
N = n^2;
all_A = zeros(n, n, r);
all_B = zeros(n, n, r);

for i = 1:r
    all_A(:, :, i) = rand(n, n);
    all_B(:, :, i) = rand(n, n);
end

Test1 = zeros(n^2, n^2);
for i = 1:r
    A = all_A(:, :, i);
    B = all_B(:, :, i);
    Test1 = Test1 + vec(A)*vec(B)';
end

Test2_kron = zeros(n^2, n^2);
for i = 1:r
    A = all_A(:, :, i);
    B = all_B(:, :, i);
    Test2_kron = Test2_kron + kron(A, B);
end

Test2 = mat_vec(Test2_kron);



Test1 - Test2



%%
R_mat = zeros()






%%

function R = mat_vec(K)

N = length(K);
n = sqrt(N);

K_blocks = permute(reshape(K, n, n, n, n), [1, 3, 2, 4]);
R = permute(reshape(K_blocks, N, N), [2, 1]);

% R = zeros(N, N);
% k = 1;
% for i = 1:n
%     for j = 1:n
%         [i, j];
%         K_cur = K(((j-1)*n+1):j*n, ((i-1)*n+1):i*n);
%         R_cur = vec(K_cur);
%         R(k, :) = R_cur';
%         k = k+ 1;
%     end
% end
end





